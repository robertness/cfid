---
title: "visualization"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{visualization}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(cfid)
```

Plotting the graph using dagitty and ggdag.
It is best not to load dagitty directly, as it's namespace clashes with cfid.
Dagitty doesn't accept the special characters that cfid uses in labeling variables, so `get_edgestring` does some reformatting.
Specifically [U[X, Y] becomes U_XY.

```{r}
g_ <- cfid::dag("X -> W -> Y <- Z <- D X <-> Y")
dagitty_g <- export_graph(g_, "dagitty")
ggdag::ggdag(dagitty_g) + ggdag::theme_dag_gray()
```


Exporting an edge list so we can plot with tools like bnlearn and Rgraphviz.
Rgraphviz needs to be installed via bioconductor.

```{r}
net <- bnlearn::empty.graph(nodes=get_nodes(g_))
el <- get_edgelist(g_)
bnlearn::arcs(net) <- el
bnlearn::graphviz.plot(net)
```


The following graph is an intermediate object created in the following call to ``identifiable."

```{r}
v1 <- cf("Y", 0, c(X = 0))
v2 <- cf("X", 1)
v3 <- cf("Z", 0, c(D = 0))
v4 <- cf("D", 0)
c1 <- conj(v1, v2, v3, v4)
g1 <- dag("X -> W -> Y <- Z <- D X <-> Y")

identifiable(g1, c1)

el <- data.frame(
  from=c("x", "W_{x}",  "Z_{x}",  "U[X,Y]", "D_{x}",  "d",  "U[X,Y]"),
  to=c("W_{x}", "Y_{x}", "Y_{x}", "Y_{x}", "Z_{x}", "Z_{x}", "X")
)

cg_nodes <- c("x", "W_{x}", "Z_{x}", "U[X,Y]", "D_{x}",  "d", "Y_{x}",  "X")
net <- bnlearn::empty.graph(nodes=cg_nodes)
bnlearn::arcs(net) <- el
bnlearn::graphviz.plot(net)
```

